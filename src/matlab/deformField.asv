function deformField(Aff, VG)

deformMat = zeros([VG.dim, 3]);

[XX, YY, ZZ] = meshgrid(1:VG.dim(1), 1:VG.dim(2), 1:VG.dim(3));

deformVec = Aff\VG.mat*[XX(:)'; YY(:)'; ZZ(:)'; ones(1, numel(XX(:)))];

for aa = 1:3
    deformMat(:, :, :, aa) = reshape(deformVec(aa, :), VG.dim);
end

ni = nifti;
ni.dat = file_array('y_deform.nii'